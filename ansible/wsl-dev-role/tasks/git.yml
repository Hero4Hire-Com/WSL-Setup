---
# tasks file for wsl-git-credentials-manager
- name: "**git** Install apt packages"
  become: yes
  ansible.builtin.apt:
    name:
      - xdg-utils
    update_cache: yes
    state: present

- name: "**git** Install git cred manager"
  become: yes
  ansible.builtin.apt:
    deb: https://github.com/GitCredentialManager/git-credential-manager/releases/download/v2.0.886/gcm-linux_amd64.2.0.886.deb

- name: "**git** configure git to use get cred manager"
  shell: |
    git-credential-manager configure
    git config --global credential.guiPrompt false

- name: "**git** Set Credential Manager types and store"
  become: yes
  copy:
    content:  |
      export GCM_CREDENTIAL_STORE=cache
      export GCM_AZREPOS_CREDENTIALTYPE="oauth"
    dest: /etc/profile.d/gitconfig.sh

- name: "**git** setup git name"
  git_config:
    name: user.name
    scope: global
    value: "{{ git_username }}"

- name: "**git** setup git user email"
  git_config:
    name: user.email
    scope: global
    value: "{{ git_email }}"

- name: "**git** setup git default branch"
  git_config:
    name: init.defaultbranch
    scope: global
    value: "main"